---
layout:     post
title:      "某车之家字体反爬升级"
subtitle:   
date:       2021-05-12
author:     胖胖很瘦
thumbnail:  /images/52350b59/thumbnail.png
catalog: true
categories: 爬虫之路
original_url: https://mp.weixin.qq.com/s/dHUuKtsAXK7dAVAKTg-7lg
tags:
    - 爬虫之路
---

![](/images/52350b59/1.png)

![](/images/52350b59/2.png)

![](/images/52350b59/3.png)

直接开始

## 小伙伴留言说, 某车之家的字体反爬脚本用不了了, 抽了空就先打开网站看一下, 结果发现看不见字符的源码了, 在控制台, 请求源码, 甚至python请求的html都变成了符号

# html中

![](/images/52350b59/4.png)

# 控制面板源码中

![](/images/52350b59/5.png)

# python请求源码中

![](/images/52350b59/6.png)

全部都变成了 一个方块一个问号(打不出来)

但是试了一下字体文件部分的, 都还可以用, 所以就直接从编码下手了

不过这个编码也不太好弄,  需要转来转去的, 最后结果是解决了✌️

![](/images/52350b59/7.png)

![](/images/52350b59/8.png)

脚本也升级!

# 升级版

涉及修改的代码, 其余与第二篇一样

```
def repalce_source_code(self, html):
    #  转为 编码 比如: \uec8e
    html = html.encode("latin-1", "backslashreplace").decode("utf-8")
    for utf_code, word in self.new_unicode_map.items():
        html = html.replace("\\u%s" % utf_code[3:].lower(), word)
    # 再次将替换后的字符转为正常unicode
    html = html.encode("latin-1", "backslashreplace").decode("utf-8")
    # 转为中文
    html = html.encode("utf-8").decode("unicode_escape")
    return html

def get_subject_content(self):
    # 使用xpath 获取 主贴, 先获取主贴, 只替换主贴内容
    xp_html = etree.HTML(self.page_html)
    subject_text = ''.join(xp_html.xpath('//div[@class="tz-paragraph"]//text()'))
    return self.repalce_source_code(subject_text)

```

 

这次升级其实并没有较大的改动, 只是需要转几次编码, 脚本可以直接运行

![](/images/52350b59/9.png)

推荐阅读

[某车之家字体反爬一(单页面)](http://mp.weixin.qq.com/s?__biz=MzUyMzk3OTYyMQ==&mid=2247483799&idx=1&sn=88f17e85141f60094afa93220685020a&chksm=fa351f9dcd42968b10be512341358940ebe29dc650566edd0866595c03f0d7ee8f0dd939a391&scene=21#wechat_redirect)

[某车之家字体反爬一(任意页面)](http://mp.weixin.qq.com/s?__biz=MzUyMzk3OTYyMQ==&mid=2247483801&idx=1&sn=9c3599ccbeeb888f9707bf5d1599ccb7&chksm=fa351f93cd429685bf08146e059d0b6896f2cf5bfbf3cbd31a662cd32ae1cfc18bbb0a05dbb4&scene=21#wechat_redirect)

[吃饱了么! 数据抓取](http://mp.weixin.qq.com/s?__biz=MzUyMzk3OTYyMQ==&mid=2247484128&idx=2&sn=73e018406815731cd7a72ce0ee5727fc&chksm=fa351ceacd4295fcbc7e38e1e3f5c14baf2cf10734487cff036da7d4a5ac84214e9b2f1908d7&scene=21#wechat_redirect)