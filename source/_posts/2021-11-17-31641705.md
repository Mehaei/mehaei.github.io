---
layout:     post
title:      "keycloak 添加用户注册邮箱后缀验证"
subtitle:   
date:       2021-11-17
author:     胖胖很瘦
thumbnail:  /images/31641705/thumbnail.png
catalog: true
categories: docker
original_url: https://mp.weixin.qq.com/s/ddYokbH_fS-GWQNox-cjVw
tags:
    - docker
    - keycloak
---

### 

### 

![](/images/31641705/1.png)

keycloak简介

![](/images/31641705/2.png)

### 

官网: https://www.keycloak.org/

docker image:

https://hub.docker.com/r/jboss/keycloak/

keycloak可以开启邮箱注册功能, 也可以验证邮箱激活, 但是没有验证邮箱后缀的功能

### 

![](/images/31641705/3.png)

插件介绍

![](/images/31641705/4.png)

Github地址:

https://github.com/micedre/keycloak-mail-whitelisting

下载地址:

https://github.com/micedre/keycloak-mail-whitelisting/releases/download/1.1/keycloak-mail-whitelisting-1.1.jar

不能科学上网的, 我上传到了百度网盘  
链接:https://pan.baidu.com/s/1HyTUysQqXsGWeIFK2BkqMw密码:vy6s

### 

![](/images/31641705/5.png)

配置步骤

![](/images/31641705/6.png)

首先将下来的jar包复制到**$KEYCLOAK\_HOME\standalone\deployments**文件夹中

```
docker cp keycloak-mail-whitelisting-1.1.jar keycloak:/opt/jboss/keycloak/standalone/deployments
# 我是用的docker方式安装的, keycloak部署目录是/opt/jboss/keycloak、
```

打开注册功能

![](/images/31641705/7.png)

配置发送邮件配置(如果不需要, 可以不配置)  
![](/images/31641705/8.png)

复制一份用户注册流程  
![](/images/31641705/9.png)

重命名  
![](/images/31641705/10.png)

选择复制后的流程, 添加执行动作  
![](/images/31641705/11.png)

选择**Profile Validation With Email Domain Check**保存  
![](/images/31641705/12.png)

选择启用**Profile Validation With Email Domain Check**流程  
![](/images/31641705/13.png)

配置允许注册的域名  
![](/images/31641705/14.png)

添加白名单, 支持多个

![](/images/31641705/15.png)

替换注册流程  
![](/images/31641705/16.png)

### 

### 

![](/images/31641705/17.png)

测试

![](/images/31641705/18.png)

现在就可以测试注册功能了

163的可以成功注册  
![](/images/31641705/19.png)  
![](/images/31641705/20.png)

gmail的会返回无效的邮箱地址  
![](/images/31641705/21.png)

### 

### 

![](/images/31641705/22.png)

后续

![](/images/31641705/23.png)

看插件作者的动态还会继续更新这个插件, 未来会加上黑名单, 登录验证邮箱等

扫描二维码

获取更多精彩

不止于python

![](/images/31641705/24.png)