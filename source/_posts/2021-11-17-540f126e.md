---
layout:     post
title:      "keycloak 添加 注册邮箱后缀验证-不止于python"
subtitle:   
date:       2021-11-17
author:     不止于python
thumbnail:  /images/default-post-thumbnail.png
catalog: true
categories: docker
original_url: https://www.cnblogs.com/mswei/p/15568561.html
tags:
    - docker
    - Keycloak
---

### 转自

[ [不止于python](https://mp.weixin.qq.com/s/ddYokbH_fS-GWQNox-cjVw "不止于python") ]

### keycloak简介

官网: <https://www.keycloak.org/>  
docker image: <https://hub.docker.com/r/jboss/keycloak/>  
keycloak可以开启邮箱注册功能, 也可以验证邮箱激活, 但是没有验证邮箱后缀的功能

### 插件介绍

Github地址: <https://github.com/micedre/keycloak-mail-whitelisting>  
下载地址: <https://github.com/micedre/keycloak-mail-whitelisting/releases/download/1.1/keycloak-mail-whitelisting-1.1.jar>  
不能xxxx的, 我上传到了百度网盘  
链接:<https://pan.baidu.com/s/1HyTUysQqXsGWeIFK2BkqMw> 密码:vy6s

### 配置步骤

首先将下来的jar包复制到 **$KEYCLOAK\_HOME\standalone\deployments** 文件夹中

```
docker cp keycloak-mail-whitelisting-1.1.jar keycloak:/opt/jboss/keycloak/standalone/deployments

# 我是用的docker方式安装的, keycloak部署目录是/opt/jboss/keycloak
```

打开注册功能  
![file](/images/540f126e/1.png)

配置发送邮件配置(如果不需要, 可以不配置)  
![file](/images/540f126e/2.png)

复制一份用户注册流程  
![file](/images/540f126e/3.png)

重命名  
![file](/images/540f126e/4.png)

选择复制后的流程, 添加执行动作  
![file](/images/540f126e/5.png)

选择 **Profile Validation With Email Domain Check** 保存  
![file](/images/540f126e/6.png)

选择启用 **Profile Validation With Email Domain Check** 流程  
![file](/images/540f126e/7.png)

配置允许注册的域名  
![file](/images/540f126e/8.png)

添加白名单, 支持多个  
![file](/images/540f126e/9.png)

替换注册流程  
![file](/images/540f126e/10.png)

### 测试

现在就可以测试注册功能了

163的可以成功注册  
![file](/images/540f126e/11.png)  
![file](/images/540f126e/12.png)

gmail的会返回无效的邮箱地址  
![file](/images/540f126e/13.png)

### 后续

看插件作者的动态还会继续更新这个插件, 未来会加上黑名单, 登录验证邮箱等