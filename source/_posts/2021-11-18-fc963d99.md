---
layout:     post
title:      "ä½¿ç”¨python seleniumè§£å†³è°·æ­ŒéªŒè¯ç (reCAPTCHA)"
subtitle:   
date:       2021-11-18
author:     èƒ–èƒ–å¾ˆç˜¦
thumbnail:  /images/fc963d99/thumbnail.png
catalog: true
categories: python
original_url: https://mp.weixin.qq.com/s/Fm-4Hxj1RDwhbroB6MaRow
tags:
    - python
    - è°·æ­Œ
    - çˆ¬è™«ä¹‹è·¯
---

![](/images/fc963d99/1.png)

reCAPTCHAä»‹ç»

ä½“éªŒåœ°å€:

Â Â Â Â https://www.google.com/recaptcha/api2/demo

ä½œä¸ºä¸€ä¸ªæ–°æ—¶ä»£å†œæ°‘, ç›¸ä¿¡ä½ æˆ–å¤šæˆ–å°‘è§è¿‡, å°±é•¿è¿™æ ·  
![](/images/fc963d99/2.png)  
å¦‚æœç‚¹å‡»å, å‘ç°å½“å‰ç³»ç»Ÿå­˜åœ¨é£é™©, ä¼šå‡ºæ¥å›¾ç‰‡éªŒè¯, è¿™ä¸ªå›¾ç‰‡éªŒè¯å¯èƒ½æ˜¯å‡ å¼ å›¾ç‰‡, ç‚¹å‡»å®Œæäº¤, ä¹Ÿæœ‰å¯èƒ½æ˜¯ç‚¹å‡»å®Œç¬¦åˆæ¡ä»¶çš„å›¾ç‰‡å, ä¼šåœ¨åŸä½ç½®, å‡ºæ¥ä¸€å¼ æ–°çš„å›¾ç‰‡, ä¸€ç›´ç‚¹åˆ°æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å›¾ç‰‡å, ç‚¹å‡»æäº¤, åƒè¿™æ ·çš„

![](/images/fc963d99/3.png)

ä¹Ÿå¯ä»¥ç‚¹å‡»è€³æœºæŒ‰é’®, åˆ‡æ¢åˆ°å¬å†™æ¨¡å¼  
![](/images/fc963d99/4.png)

### 

![](/images/fc963d99/5.png)

reCAPTCHAç‰ˆæœ¬

**V1:** ç®€å•çš„æ–‡å­—è¯†åˆ«

Â Â Â Â Â Â Â Â Â 2012å¹´èµ·ï¼ŒreCAPTCHAé™¤äº†åŸæ¥çš„æ–‡å­—æ‰«æå›¾ç‰‡å¤–ï¼Œä¹Ÿé‡‡ç”¨Googleè¡—æ™¯æ‹æ‘„çš„é—¨ç‰Œå·ç ç…§ç‰‡ã€‚ç›®å‰åŸºæœ¬è§ä¸åˆ°äº†

![](/images/fc963d99/6.png)

**V2:** å°±æ˜¯éœ€è¦ç‚¹é€‰çš„, æ˜¾å¼çš„éªŒè¯

Â Â Â  Â Â Â  2014å¹´å¹´åº•ï¼Œæ”¹ä»¥â€œæˆ‘ä¸æ˜¯æœºå™¨äººâ€ï¼ˆIâ€™m not a robotï¼‰äºæ–¹æ¡†ä¸­æ‰“å‹¾ï¼Œè¿›è€Œå®Œæˆåˆ¤åˆ«ã€‚å¹¶å¼€å§‹é‡‡ç”¨å¬å•è¯çš„éªŒè¯ç æ¨¡å¼ã€‚

![](/images/fc963d99/7.png)  
**V3:**Â æ— æ„ŸéªŒè¯, æ˜¯ä¸€ä¸ªåˆ†æ•°åˆ¶éªŒè¯ç³»ç»Ÿ, æ ¹æ®ç”¨æˆ·è¡Œä¸º, è®¡ç®—ä¸€ä¸ªåˆ†æ•°

Â Â Â Â Â Â Â Â Googleå‘å¸ƒreCAPTCHA v3ï¼Œé‡‡ç”¨åˆ†æ•°åˆ¶éªŒè¯ç³»ç»Ÿï¼Œå¯¹ç”¨æˆ·åœ¨ç½‘ç«™ä¸Šçš„åŠ¨ä½œè¿›è¡Œè¯„åˆ†ï¼Œè‹¥åˆ†æ•°è¿‡ä½åˆ™ä¼šè¢«åˆ¤å®šä¸ºæœºå™¨äºº

![](/images/fc963d99/8.png)

### 

![](/images/fc963d99/9.png)

è§£å†³æ–¹æ¡ˆå¹³å°

**2captcha**

Â Â Â Â Â https://2captcha.com/

Â Â Â Â ä¸ä½†æ”¯æŒreCAPTCHA, è¿˜æ”¯æŒ TikTokç­‰ç­‰éªŒè¯, åŠŸèƒ½é½å…¨, ä½†æ¯”è¾ƒè´µ

**yescaptcha**

Â  Â  Â  Â http://yescaptcha.365world.com.cn/  
Â Â Â Â Â Â åªæ”¯æŒreCAPTCHAéªŒè¯, ç›®å‰V3ç‰ˆæœ¬éªŒè¯è´¨é‡ä¸€èˆ¬, ä»·æ ¼ç¾ä¸½, è€Œä¸”æ³¨å†Œå°±é€1500ç‚¹æ•°, ä¸€æ¬¡15ç‚¹æ•°, å¯ä»¥è°ƒç”¨100æ¬¡, æµ‹è¯•è¶³å¤Ÿäº†, å……å€¼çš„è¯æ˜¯1å…ƒ1000ç‚¹

![](/images/fc963d99/10.png)

ä½¿ç”¨æ–¹æ³•

ä»¥**yescaptcha**ä¸ºä¾‹, è¯´ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨(ä¸¤ä¸ªå¹³å°éªŒè¯æµç¨‹å‡ ä¹ç›¸åŒ)

**æ‰€éœ€å‚æ•°**

![](/images/fc963d99/11.png)

\*Â **TOKEN**:Â http://yescaptcha.365world.com.cn/Â æ³¨å†Œåä¼šç”Ÿæˆä¸€ä¸ªtoken  
![](/images/fc963d99/12.png)  
\* **REFERER**: ç½‘ç«™éªŒè¯çš„referer, æ‰¾åˆ°xxxx/api.jsçš„è¯·æ±‚  
![](/images/fc963d99/13.png)  
\* **SITE\_KEY**: æ‰¾åˆ°ancherçš„è¯·æ±‚  
![](/images/fc963d99/14.png)  
æˆ–è€…å³å‡»æŸ¥çœ‹ç½‘é¡µæºä»£ç , æ‰¾åˆ°`data-sitekey`  
![](/images/fc963d99/15.png)

**åˆ›å»ºéªŒè¯ç ä»»åŠ¡**

**url**

Â Â Â Â http://api.yescaptcha.365world.com.cn/v3/recaptcha/create

**å‚æ•°:**

|  |  |  |
| --- | --- | --- |
| å‚æ•°å | æ˜¯å¦å¿…é¡» | è¯´æ˜ |
| token | æ˜¯ | è¯·åœ¨ä¸ªäººä¸­å¿ƒè·å– (Token) |
| siteKey | æ˜¯ | ReCaptcha SiteKey ï¼ˆå›ºå®šå‚æ•°ï¼‰ |
| siteReferer | æ˜¯ | ReCaptcha Referer ï¼ˆä¸€èˆ¬ä¹Ÿä¸ºå›ºå®šå‚æ•°ï¼‰ |
| captchaType  ï¼ˆéªŒè¯ç ç‰ˆæœ¬ï¼‰ | å¦ | ReCaptchaV2(é»˜è®¤) / ReCaptchaV3  ä¸çŸ¥é“æ˜¯å“ªä¸€ç§çœ‹åé¢çš„è¯´æ˜  ReCaptchaV3 V3å¿…å¡« |
| siteAction | å¦ | ReCaptchaV3 å¿…å¡«Â ActionåŠ¨ä½œ é»˜è®¤verify |
| minScore | å¦ | ReCaptchaV3 é€‰å¡« æœ€å°åˆ†æ•°ï¼ˆ0.1-0.9ï¼‰ |

**ä»£ç **

ä¼šè¿”å›ä¸€ä¸ªä»»åŠ¡id, ç”¨äºè·å–éªŒè¯ç»“æœ

![](/images/fc963d99/16.png)

**è·å–ä»»åŠ¡ç»“æœ****url**

Â Â Â Â http://api.yescaptcha.365world.com.cn/v3/recaptcha/status

**å‚æ•°**

|  |  |  |
| --- | --- | --- |
| å‚æ•°å | æ˜¯å¦å¿…é¡» | è¯´æ˜ |
| taskId | æ˜¯ | åˆ›å»ºä»»åŠ¡è·å–åˆ°çš„ID |

**ä»£ç **

![](/images/fc963d99/17.png)

![](/images/fc963d99/18.png)

demoç½‘ç«™éªŒè¯

**ä½¿ç”¨requests**

![](/images/fc963d99/19.png)

**éªŒè¯ç»“æœ**![](/images/fc963d99/20.png)

**ä½¿ç”¨selenium:**åœ¨é¡µé¢ä¸Šæœ‰ä¸¤ç§æ–¹å¼  
**å›è°ƒ:**

Â Â Â Â åœ¨é¡µé¢ä¸Šçœ‹ä¸åˆ°ç‚¹å‡»éªŒè¯, è€Œæ˜¯åœ¨ç™»å½•çš„æ—¶å€™æ‰ä¼šè°ƒç”¨éªŒè¯,è¿™ç§çš„å°±è¦æ‰¾å›è°ƒå‡½æ•°, ç„¶åä½¿ç”¨å›è°ƒå‡½æ•°åŠ ä¸ŠéªŒè¯çš„tokenè°ƒç”¨

**æ–‡æ¡£:**Â https://shimowendang.com/docs/5o4z8XhhvsUSzYFa/read

**éå›è°ƒ**:  
Â Â Â Â åœ¨é¡µé¢ä¸Šå¯ä»¥çœ‹åˆ°éªŒè¯, éªŒè¯å®Œå, ç„¶åå¯ä»¥ç‚¹å‡»ç™»å½•, å°±åƒæˆ‘ä»¬æ­£åœ¨éªŒè¯çš„demoç½‘ç«™  
![](/images/fc963d99/21.png)

**ä»£ç **:Â  https://shimowendang.com/docs/vQRuIEUiT5ocoAZ9/read

**åœ¨é¡µé¢ä¸ŠéªŒè¯**  
æ‰“å¼€æ§åˆ¶å°, æœç´¢Â `g-recaptcha-response`çš„æ–‡æœ¬æ¡†å…ƒç´   
![](/images/fc963d99/22.png)

å³å‡»ä¿®æ”¹å…ƒç´ 

![](/images/fc963d99/23.png)

æŠŠtokenå¤åˆ¶è¿›å»

![](/images/fc963d99/24.png)

ä¹Ÿå¯ä»¥åœ¨æ§åˆ¶å°, ä½¿ç”¨jsç›´æ¥èµ‹å€¼

```
document.getElementById("g-recaptcha-response").innerHTML="TOKEN_FROM_YESCAPTCHA";
```

è¿™æ ·å°±ä¸éªŒè¯ä¹Ÿå¯ä»¥ç›´æ¥ç‚¹å‡»æäº¤, ç„¶åå›è·³è½¬åˆ°éªŒè¯æˆåŠŸé¡µé¢  
![](/images/fc963d99/25.png)

### 

![](/images/fc963d99/26.png)

å®Œæ•´ä»£ç 

```
# -*- coding: utf-8 -*-
import requests
import time


class ReCAPTCHA(object):
    # Token
    TOKEN = 'xxxxxxxxxx'
Â Â Â Â REFERERÂ =Â 'https://www.google.com/recaptcha/api2/demo'
    BASE_URL = 'http://api.yescaptcha.365world.com.cn'
    # Site Key
Â Â Â Â SITE_KEYÂ =Â '6Le-wvkSAAAAAPBMRTvw0Q4Muexq9bi0DJwx_mJ-'
    CREATE_TASK_URL = f"{BASE_URL}/v3/recaptcha/create?token={TOKEN}&siteKey={SITE_KEY}&siteReferer={REFERER}"
    GET_TOKEN_URL = "{BASE_URL}/v3/recaptcha/status?token={TOKEN}&taskId={task_id}"
    TASK_ID = None

    @classmethod
    def create_task(cls):
        try:
            response = requests.get(cls.CREATE_TASK_URL)
            if response.status_code == 200:
                data = response.json()
                cls.TASK_ID = data.get('data', {}).get('taskId')
                print(f"Task created, ID:{cls.TASK_ID}")
        except requests.RequestException as e:
            print(f'Create task failed:{e}')

    @classmethod
    def get_token(cls, task_id=None, retry_times=120):
        if not task_id:
            cls.create_task()
        task_id = task_id or cls.TASK_ID
        if not task_id:
            print("Not found task id")
            return False

        print(f"Start pull task:{task_id} result")
        url = cls.GET_TOKEN_URL.format(BASE_URL=cls.BASE_URL, TOKEN=cls.TOKEN, task_id=task_id)
        count = 0
        while count < retry_times:
            try:
                response = requests.get(url)
                if response.status_code == 200:
                    data = response.json()
                    status = data.get('data', {}).get('status')
                    print('task status', status)
                    if status == 'Success':
                        return data.get('data', {}).get('response')
            except requests.RequestException as e:
                print('task failed', e)
            finally:
                count += 1
                time.sleep(1)


def verify(response_token):
    url = "https://www.google.com/recaptcha/api2/demo"
    data = {
        "g-recaptcha-response": response_token
    }
    response = requests.post(url, data=data)
    if response.status_code == 200:
        print("Verify Success")
        return response.text


if __name__ == "__main__":
    token = ReCAPTCHA.get_token()
    print(token)
    # verify(token)

```

è¿è¡Œç»“æœ

|
|  |

![](/images/fc963d99/27.png)

~~ğŸ¥³ğŸ¥³ğŸ¥³

æ‰«æäºŒç»´ç 

è·å–æ›´å¤šç²¾å½©

ä¸æ­¢äºpython

![](/images/fc963d99/28.png)