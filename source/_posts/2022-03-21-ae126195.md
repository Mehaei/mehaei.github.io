---
layout:     post
title:      "psycopg2设置语句执行时间超时"
subtitle:   
date:       2022-03-21
author:     Mehaei
thumbnail:  /images/ae126195/thumbnail.png
catalog: true
categories: python
original_url: https://mp.weixin.qq.com/s/fA7k4lSVtL8ihnEPddHRjg
tags:
    - python
    - python杂谈
---

**原文**

> https://stackoverflow.com/questions/19963954/set-transaction-query-timeout-in-psycopg2

**设置方式**

1.代码中添加options

```
>>> import psycopg2
>>> cnn = psycopg2.connect("dbname=test options='-c statement_timeout=1000'")
>>> cur = cnn.cursor()
>>> cur.execute("select pg_sleep(2000)")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
psycopg2.extensions.QueryCanceledError: canceling statement due to statement timeout
```

2.添加到系统环境变量中(PGOPTIONS)

```
>>> import os
>>> os.environ['PGOPTIONS'] = '-c statement_timeout=1000'
>>> import psycopg2
>>> cnn = psycopg2.connect("dbname=test")
>>> cur = cnn.cursor()
>>> cur.execute("select pg_sleep(2000)")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
psycopg2.extensions.QueryCanceledError: canceling statement due to statement timeout
```

**相关文章参考**

> https://postgresqlco.nf/doc/en/param/statement\_timeout/

> https://blog.crunchydata.com/blog/control-runaway-postgres-queries-with-statement-timeout

> https://iotespresso.com/how-to-configure-statement-timeout-in-psycopg2/

![](/images/ae126195/1.png)