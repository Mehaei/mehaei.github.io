---
layout:     post
title:      "内部函数和闭包"
subtitle:   
date:       2023-06-03
author:     胖胖很瘦
thumbnail:  /images/dd4c7489/thumbnail.png
catalog: true
categories: python
original_url: https://mp.weixin.qq.com/s/F_JH7eEOkU5_0Ni5Tf-tLw
tags:
    - python
    - 函数
    - py小白
---

# 

![](/images/dd4c7489/1.png)

# 说过了python的LEGB作用域, 应该有的人会对嵌套函数比较陌生, 接下来我们继续学习

# 

嵌套函数

> 也称内部函数, 即函数内部生成的函数

**格式：**

```
def 函数名():
    局部变量...
    def 内部函数名():
        代码...
```

**示例:**

```
def outer():
    print("Call outer function")
    def inner():
        print("Call inner function")
    inner()

outer()
# 输出
# Call outer function
# Call inner function

# 直接调用内部函数
inner()
# 报错
# 内部函数不能在函数外部直接调用, 只能在函数内部调用
"""
Traceback (most recent call last):
  File "/Users/Mehaei/test.py", line 135, in <module>
    inner()
NameError: name 'inner' is not defined
"""
```

**示例：**

```
def outer():
    print("Call outer function")
    def inner():
        print("Call inner function")
    return inner

outer()
# 输出
# Call outer function

# 调用inner
outer()()
# OR
call_inner = outer()
call_inner()

# 输出
# Call outer function
# Call inner function

# 直接调用内部函数
inner()
# 报错
# 内部函数不能在函数外部直接调用, 只能在函数内部调用
"""
Traceback (most recent call last):
  File "/Users/Mehaei/test.py", line 135, in <module>
    inner()
NameError: name 'inner' is not defined
"""
```

闭包

> 使用特定或特殊的方式，将局部变量(内部函数)引入到全局环境中使用，这就是闭包操作。

**闭包方法1：**

```
def 函数名():
    局部变量...
    def 内部函数名():
        pass
    return (局部变量，内部函数...)
```

**闭包方法2：**

```
def 函数名():
    局部变量
    def 内部函数名():
        pass
    #获取所有需要进行闭包操作的函数和变量
    defall():
        return(局部变量,内部函数...)
    return all
```

**闭包的优缺点：**

```
优点：    1.可以方便的进行函数式编程，组织程序代码    2.使内部函数和局部变量在外部可以访问缺点：
    1.闭包操作会导致整个函数的内部环境，被长久保存，占用大量内存。

```

**闭包环境查看：\_\_closure\_\_**

`用于查询当前闭包操作所使用的环境中的变量和内部函数等信息。`

## **nonlocal**

---

> nonlocal关键字的意义，不是局部变量，当然他也不是全局变量，通常用于内部函数中使用外部函数的局部变量。

```
#声明一个外部函数
def outer():
    #声明一个变量(肯定不是全局变量)
    x = 5
    #声明一个内部函数
    def inner():
        nonlocal x  #声明x不是局部变量
        x += 9
        print(x)
    #调用函数
    inner()
#调用outer
outer()

'''注释：
如果内部函数想使用全局变量，那么应该使用global声明变量
(函数最外层的全局变量)
如果内部函数使用的是外部函数的局部变量，那么应该使用nonlocal声明
(内部函数的外层，外部函数的局部变量)
'''
```

![](/images/dd4c7489/2.png)