---
layout:     post
title:      "如何在人大金仓数据库中使用 INNER JOIN 并自定义ON的连接条件"
subtitle:   
date:       2024-05-15
author:     胖胖很瘦
thumbnail:  /images/ef855f02/thumbnail.png
catalog: true
categories: python高级
original_url: https://mp.weixin.qq.com/s/XLRAy1I2h-VjY6bix3Oetg
tags:
    - python高级
    - 数据库
---

#### **简介**

        在数据库操作中，联表查询是一个非常常见的需求。人大金仓数据库（KingbaseES）作为一款优秀的关系型数据库，也提供了强大的连表查询功能。在进行连表查询时，有时我们需要自定义连接条件，以满足特定的业务需求。本文将介绍如何在 KingbaseES 中使用 `INNER JOIN ON` 并自定义连接条件，具体示例将展示如何去掉连接字段的第一个字符。

#### **示例表结构**

为了演示如何在 `INNER JOIN` 中自定义连接条件，我将创建两张示例表 `table_a` 和 `table_b`，并插入一些示例数据。

```
-- 创建示例表 table_a  
CREATE TABLE table_a (  
    id SERIAL PRIMARY KEY,  
    b VARCHAR(50)  
);  
  
-- 插入示例数据到 table_a  
INSERT INTO table_a (b) VALUES ('12345'), ('67890'), ('23456');  
  
-- 创建示例表 table_b  
CREATE TABLE table_b (  
    id SERIAL PRIMARY KEY,  
    b VARCHAR(50)  
);  
  
-- 插入示例数据到 table_b  
INSERT INTO table_b (b) VALUES ('812345'), ('867890'), ('823456');
```

在上述示例中，`table_a` 和 `table_b` 中的 `b` 列是我们需要连接的字段。

![](/images/ef855f02/1.png)

#### 使用 `INNER JOIN ON` 自定义连接条件

如果是正常的数据是`table_a.b` 等于 `table_b.b` 字段值的，就可以这样写

```
SELECT a.*, b.*  
FROM table_a a  
INNER JOIN table_b b  
ON a.b = b.b;
```

但是现在希望实现的连接条件是：`table_a.b` 等于 `table_b.b` 去掉第一个字符后的值。就可以使用 `SUBSTRING` 或 `RIGHT` 函数来实现这一需求。

##### **使用 `SUBSTRING` 函数**

```
SELECT a.*, b.*  
FROM table_a a  
INNER JOIN table_b b  
ON a.b = SUBSTRING(b.b FROM 2);
```

在这个查询中，`SUBSTRING(b.b FROM 2)` 表示从 `b.b` 的第二个字符开始提取子字符串，从而去掉第一个字符。

##### **使用 `RIGHT` 函数**

```
SELECT a.*, b.*  
FROM table_a a  
INNER JOIN table_b b  
ON a.b = RIGHT(b.b, LENGTH(b.b) - 1);
```

在这个查询中，`RIGHT(b.b, LENGTH(b.b) - 1)` 表示获取 `b.b` 的右边所有字符，长度为 `b.b` 的总长度减去1，从而实现去掉第一个字符的效果。

#### **结果说明**

假设我们的数据如下：

* `table_a` 数据：

+ 12345
+ 67890
+ 23456

* `table_b` 数据：

+ 812345
+ 867890
+ 823456

运行上述 `INNER JOIN` 查询后，结果如下：

```
id | b | id | b   
----+--------+----+--------  
  1 | 12345  | 1 | 812345  
  2 | 67890 |  2 | 867890  
  3 | 23456  | 3 | 823456
```

可以看到，查询结果正确地将 `table_a.b` 和 `table_b.b` 的第一个字符去掉后进行了匹配。是可以实现预期的效果

#### **总结**

        本文介绍了如何在人大金仓数据库中使用 `INNER JOIN` 并自定义连接条件，通过示例演示了如何去掉连接字段的第一个字符。使用字符串函数如 `SUBSTRING` 或 `RIGHT` 可以灵活地处理连接条件，从而满足复杂的业务需求。希望本文能为你的数据库操作提供一点点有用的参考。