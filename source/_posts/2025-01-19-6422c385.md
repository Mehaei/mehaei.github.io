---
layout:     post
title:      "给Docker添加其他用户操作权限并修改Docker容器日志文件大小配置"
subtitle:   
date:       2025-01-19
author:     胖胖很瘦
thumbnail:  /images/6422c385/thumbnail.png
catalog: true
categories: docker
original_url: https://mp.weixin.qq.com/s/0zd3t7k9CYcwTLevh0KFHw
tags:
    - docker
---

## 前言

在Docker的默认配置中，只有root用户有权限运行Docker命令。但是，为了方便其他用户能够使用Docker，我们通常会将用户添加到Docker组中。同时，Docker容器的日志文件可能会随着容器运行时间变长而不断增大，影响磁盘空间，因此配置日志文件的大小也非常重要。

## 添加用户到Docker组

Docker安装完成后，Docker默认会创建一个名为`docker`的用户组。为了让其他非root用户能够运行Docker命令，我们可以将该用户添加到`docker`组中。

### **创建新用户（如果尚未创建）**：

```
sudo useradd -m username
```

将`username`替换为你想要创建的用户名。

### **将用户添加到Docker组**

运行以下命令将用户添加到`docker`组：

```
sudo usermod -aG docker username
```

其中`username`是你想要添加到Docker组的用户名。

### **重新登录**

该用户需要退出当前会话，并重新登录才能使组的变更生效。你可以通过以下命令验证用户是否已成功加入docker组：

```
groups username
```

如果返回结果中包含`docker`，则表示用户已成功添加到Docker组。

### **验证权限**

使用非root用户运行Docker命令进行验证：

```
docker ps
```

如果没有出现权限错误，说明配置成功。

![](/images/6422c385/1.png)

## 修改Docker容器日志文件大小配置

Docker的容器日志默认存储在`/var/lib/docker/containers/<container_id>/`目录下。容器日志文件会随着时间的推移不断增大，为了避免日志文件过大占用过多磁盘空间，我们可以通过配置日志轮换（log rotation）来限制日志文件的大小。

### **修改Docker守护进程的配置文件**

在Docker的配置文件中，我们可以设置日志的最大大小和最大保留数量。首先，编辑Docker的配置文件`/etc/docker/daemon.json`（如果文件不存在，则需要手动创建）。

例如，配置文件内容可以是：

```
{  
  "log-driver": "json-file",  
  "log-opts": {  
    "max-size": "10m",  
    "max-file": "3"  
  }  
}
```

其中：

* `"log-driver": "json-file"`：指定日志驱动程序为`json-file`，这也是默认的日志驱动。
* `"max-size": "10m"`：设置每个日志文件的最大大小为10MB。
* `"max-file": "3"`：限制保留最多3个日志文件。

### **重新启动Docker服务**

配置完毕后，重启Docker守护进程以使设置生效：

```
sudo systemctl restart docker
```

### **验证配置**

你可以通过以下命令查看正在运行的容器的日志文件配置：

```
docker inspect --format '{{.HostConfig.LogConfig}}' <container_id>
```

另外，查看Docker日志文件是否按照配置进行轮换，可以通过`docker logs`命令来查看容器的输出。

## 总结

通过将用户添加到Docker组中，我们可以让非root用户也能够使用Docker命令，这样能够提高系统的灵活性。同时，修改Docker容器日志文件大小配置，可以有效避免日志文件占用过多磁盘空间，保障系统的稳定性。希望本文的步骤能帮助你更好地管理Docker容器和用户权限。

## 历史文章

* [探索冰雪奇缘：哈尔滨大世界的数据分析与创新建议（2024版）](https://mp.weixin.qq.com/s?__biz=MzUyMzk3OTYyMQ==&mid=2247488546&idx=1&sn=3df15e8ee5484a0a07e8cd483c95ff8c&scene=21#wechat_redirect "探索冰雪奇缘：哈尔滨大世界的数据分析与创新建议（2024版）")
* [人大金仓数据库中 JSON 字段查询、排序与优化技巧](https://mp.weixin.qq.com/s?__biz=MzUyMzk3OTYyMQ==&mid=2247488531&idx=1&sn=54846bd3dac3b2e262172986e29a0bcd&scene=21#wechat_redirect "人大金仓数据库中 JSON 字段查询、排序与优化技巧")
* [如何使用 tar 压缩文件时自动排除特定文件](https://mp.weixin.qq.com/s?__biz=MzUyMzk3OTYyMQ==&mid=2247488524&idx=1&sn=af32413d3bd9382eb600e93b4a0426f0&scene=21#wechat_redirect "如何使用 tar 压缩文件时自动排除特定文件")
* [如何优雅解决 Ubuntu 下的 --break-system-packages 警告](https://mp.weixin.qq.com/s?__biz=MzUyMzk3OTYyMQ==&mid=2247488510&idx=1&sn=471cf97c5a0f7a08e91f6ddff52b3d55&scene=21#wechat_redirect "如何优雅解决 Ubuntu 下的 --break-system-packages 警告")